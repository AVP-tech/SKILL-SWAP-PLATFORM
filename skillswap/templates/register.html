{% extends "base.html" %}

{% block content %}
<section class="auth-wrap">
  <div class="panel auth-card">
    <div class="panel-body">
      <div class="eyebrow">Create your profile</div>
      <h2 style="margin-bottom: 8px;">Join Skill Swap</h2>
      <p class="muted" style="margin-bottom: 16px;">Create an account to start exchanging skills with other learners.</p>

      {% if error %}
      <div class="notice notice-error" role="alert" style="margin-bottom: 12px;">{{ error }}</div>
      {% endif %}

      <form method="POST" action="{{ url_for('register_page') }}" id="registerForm" novalidate>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

        <div class="field">
          <label for="name">Full Name</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            maxlength="80"
            value="{{ request.form.get('name', '') }}"
            autocomplete="name"
          />
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            maxlength="120"
            value="{{ request.form.get('email', '') }}"
            autocomplete="email"
          />
        </div>

        <div class="field-row">
          <div class="field">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required minlength="6" autocomplete="new-password" />
            <div class="help-text">Minimum 6 characters</div>
          </div>

          <div class="field">
            <label for="confirm">Confirm Password</label>
            <input type="password" id="confirm" name="confirm" required minlength="6" autocomplete="new-password" />
          </div>
        </div>

        <div id="registerHint" class="notice notice-info hidden" role="status" aria-live="polite" style="margin-bottom: 12px;"></div>

        <button class="btn btn-primary" type="submit" style="width:100%;">Register</button>
      </form>

      <p class="footer-note">
        Already have an account?
        <a href="{{ url_for('login_page') }}" style="color:#0f8a5f;font-weight:700;">Login here</a>
      </p>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const registerForm = document.getElementById("registerForm");
  const registerHint = document.getElementById("registerHint");
  const pwdInput = document.getElementById("password");
  const confirmInput = document.getElementById("confirm");

  function showRegisterHint(message, kind = "info") {
    if (!message) {
      registerHint.textContent = "";
      registerHint.className = "notice notice-info hidden";
      return;
    }
    registerHint.textContent = message;
    registerHint.className = `notice notice-${kind}`;
  }

  function validatePasswords() {
    const pwd = pwdInput.value;
    const confirm = confirmInput.value;
    if (!pwd && !confirm) {
      showRegisterHint("");
      return true;
    }
    if (pwd.length > 0 && pwd.length < 6) {
      showRegisterHint("Password should be at least 6 characters.", "error");
      return false;
    }
    if (confirm && pwd !== confirm) {
      showRegisterHint("Passwords do not match.", "error");
      return false;
    }
    if (pwd && confirm && pwd === confirm) {
      showRegisterHint("Passwords match.", "success");
    } else {
      showRegisterHint("");
    }
    return true;
  }

  pwdInput.addEventListener("input", validatePasswords);
  confirmInput.addEventListener("input", validatePasswords);

  registerForm.addEventListener("submit", (event) => {
    if (!validatePasswords()) {
      event.preventDefault();
    }
  });
</script>
{% endblock %}
